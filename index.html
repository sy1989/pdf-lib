<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>PDF 拆分与合并工具</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
</head>
<body>
  <h1>PDF 拆分与合并工具</h1>

  <!-- 上传 PDF -->
  <h3>上传 PDF 文件</h3>
  <input type="file" id="file-input" accept="application/pdf" />
  <button id="load-btn">加载 PDF</button>
  <br /><br />

  <!-- 显示文件名 -->
  <div id="file-name-display"></div>
  <br />

  <!-- 拆分 PDF -->
  <h3>拆分 PDF</h3>
  <button id="split-btn">拆分为单页 PDF</button>
  <br /><br />

  <!-- 合并 PDF -->
  <h3>合并多个 PDF</h3>
  <input type="file" id="merge-input" accept="application/pdf" multiple />
  <button id="merge-btn">合并 PDF</button>
  <br /><br />

  <!-- 下载链接 -->
  <a id="download-link" style="display:none" download="output.pdf">下载 PDF</a>

  <script>
    const { PDFDocument } = PDFLib;
    let pdfDoc;

    // 清除之前的状态
    window.onload = function() {
      // 清空显示区域
      document.getElementById('file-name-display').textContent = '';
      // 清空文件输入
      document.getElementById('file-input').value = '';
      document.getElementById('merge-input').value = '';
    };

    // 加载 PDF 文件
    document.getElementById('load-btn').addEventListener('click', async () => {
      const file = document.getElementById('file-input').files[0];
      if (!file) return alert('请先选择一个 PDF 文件');

      // 清除之前加载的文件名显示
      document.getElementById('file-name-display').textContent = '';

      const arrayBuffer = await file.arrayBuffer();
      pdfDoc = await PDFDocument.load(arrayBuffer);

      // 显示当前加载的 PDF 文件名
      const fileName = file.name;
      document.getElementById('file-name-display').textContent = `已加载 PDF: ${fileName}`;

      alert('PDF 加载成功');
    });

    // 拆分 PDF
    document.getElementById('split-btn').addEventListener('click', async () => {
      if (!pdfDoc) return alert('请先加载一个 PDF 文件');

      const pages = pdfDoc.getPages();
      const splitPdfs = [];
      
      for (let i = 0; i < pages.length; i++) {
        const newPdf = await PDFDocument.create();
        const [copiedPage] = await newPdf.copyPages(pdfDoc, [i]);
        newPdf.addPage(copiedPage);
        const pdfBytes = await newPdf.save();
        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        splitPdfs.push(url);
      }

      // 提供下载链接
      splitPdfs.forEach((url, index) => {
        const a = document.createElement('a');
        a.href = url;
        a.download = `split_page_${index + 1}.pdf`;
        a.textContent = `下载第 ${index + 1} 页`;
        document.body.appendChild(a);
        document.body.appendChild(document.createElement('br'));
      });
    });

    // 合并 PDF 文件
    document.getElementById('merge-btn').addEventListener('click', async () => {
      const files = document.getElementById('merge-input').files;
      if (files.length < 2) return alert('请至少选择两个 PDF 文件进行合并');

      const mergedPdf = await PDFDocument.create();
      for (const file of files) {
        const arrayBuffer = await file.arrayBuffer();
        const pdf = await PDFDocument.load(arrayBuffer);
        const copiedPages = await mergedPdf.copyPages(pdf, pdf.getPageIndices());
        copiedPages.forEach(page => mergedPdf.addPage(page));
      }

      const mergedPdfBytes = await mergedPdf.save();
      const mergedPdfBlob = new Blob([mergedPdfBytes], { type: 'application/pdf' });
      const mergedPdfUrl = URL.createObjectURL(mergedPdfBlob);
      const downloadLink = document.getElementById('download-link');
      downloadLink.href = mergedPdfUrl;
      downloadLink.style.display = 'inline';
    });
  </script>
</body>
</html>
